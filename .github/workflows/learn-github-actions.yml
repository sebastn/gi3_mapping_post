name: test-POST 
on: [push]
env:
  mapping_json: 'tempor'
jobs:
  checkout:
    runs-on: ubuntu-latest
    steps:
      - name: checkout repo
        uses: actions/checkout@v2
        
      - name: test global variable
        id: step_two
        run: echo "${{ env.mapping_json }}"
        
#      - name: set environment variables
#        uses: allenevans/set-env@v2.0.0
#        with:
#          MAPPING_JSON: 'start'
      
  store_mapping:
    name: store variable
    runs-on: ubuntu-latest
    needs: [checkout]
    steps:
    - name: step two
      run: |
          pwd
          ls -ltr
          ls /home/runner/work/gi3_mapping_post/gi3_mapping_post/
          echo ${{ env.mapping_json }}
          cat @mappings.json
#          cat $GITHUB_WORKSPACE/mappings.json
#          ${{ env.mapping_json }} = $(cat ${GITHUB_WORKSPACE}/mappings.json | jq .)
  post_mapping:
    runs-on: ubuntu-latest
    steps:
    - name: post mapping
      uses: fjogeleit/http-request-action@master
      with: 
        #url: "https://tumgi3.free.beeceptor.com/my/api/path"
        url: "https://gi3.gis.lrg.tum.de/nodered/mappings"
        method: 'POST'
        #contentType: application/json
        data: ${{ env.mapping_json }}
        files: '{ "file": "${{ github.workspace  }}/mappings.json" }'
               
  test_job:             
    runs-on: ubuntu-latest
    needs: [checkout, post_mapping]
    steps:
    - name: Test step
      run: |
          echo ${{ env.mapping_json }}
          printenv
